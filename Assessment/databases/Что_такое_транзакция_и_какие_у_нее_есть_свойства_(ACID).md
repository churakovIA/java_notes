# Что такое транзакция и какие у нее есть свойства (ACID)?
---

**Реляционные базы данных в примерах, 2021, (Святослав Куликов):**

**Транзакция** — набор операций с базой данных, который представляет собой неделимую логическую единицу. Такой набор операций может быть выполнен либо целиком и успешно (с соблюдением всех правил консистентности базы данных и независимо от параллельно выполняемых транзакций), либо не выполнен вообще (в таком случае ни одна из операций, входящих в данный набор, не должна произвести никаких изменений в базе данных).  
*Упрощённо:* набор операций, который либо целиком и успешно заверша-ется, либо также целиком отменяется в случае ошибки при выполнении любой из его операций.  
Транзакция является единицей восстановимости и конкурентности.  
Итого, получается, что транзакция:

- всегда или выполняется, или не выполняется целиком;
- используется при восстановлении после различных сбоев и отказов;
- обеспечивает механизм конкурентного доступа к данным.

---

Из определения транзакции следуют свойства транзакции. Эти четыре свойства известны под аббревиатурой ACID.  
**Атомарность (atomicity)** означает, что транзакция не может быть «выполнена частично», т.е. что всегда все её операции будут либо выполнены (все и до конца), либо не выполнены (ни одна, т.е. все изменения данных будут отменены).  
**Консистентность (consistency)** означает, что успешно завершившаяся транзакция гарантированно сохраняет консистентность базы данных, т.е. фиксирует только допустимые результаты изменения данных (не противоречащие никаким ограничениям, реализованным на уровне СУБД или добавленным отдельно в базу данных в виде проверок, триггеров и т.д.). В отдельных случаях проверки дополнительных условий реализуются непосредственно в коде транзакции.
Важно отметить, что в процессе выполнения транзакции консистентность базы данных может нарушаться — так в примере во время выполнения операций обоими клиентами существует момент, когда баланс счёта-источника уже уменьшен, а баланс счёта-приёмника ещё не увеличен, т.е. деньги «пропали в никуда». Однако это внутренне состояние СУБД «не показывает» другим транзакциям, работающим с теми же данными, т.е. извне транзакции нарушения консистентности (почти) никогда не видны. «Почти» потому, что всё же существуют способы на свой страх и риск получить доступ к промежуточным состояниям базы данных — об этом будет упомянуто, когда мы будем рассматривать уровни изолированности транзакций.  
**Изолированность (isolation)** означает, что несколько выполняемых параллельно транзакций не должны влиять на результат выполнения друг друга. Если бы это свойство отсутствовало, мы могли бы получить ситуацию, когда каждая транзакция в начале читает баланс счёта A, потом изменяет его и в конце проверят, что счёт A изменился на ожидаемую величину. Но поскольку параллельно выполняемая транзакция тоже изменяет этот счёт, естественно, проверка завершится неудачей, т.к. фактический баланс счёта будет отличаться от ожидаемого.  
**Устойчивость (durability)** означает, что СУБД сама решает все «внутренние проблемы» и гарантирует, что после завершения транзакции (как успешного, так и неуспешного) все необходимые изменения были или зафиксированы, или отменены, и что база данных не вернётся в некое «промежуточное состояние». Это свойство, как правило, ассоциируют с устойчивостью к сбоям в аппаратном обеспечении, сетевом взаимодействии и т.д. Даже в таких условиях СУБД всегда «знает», какие операции были выполнены и после возвращения к нормальным условиям работы может удостовериться, что данные не повреждены (или, в самом худшем случае, сообщить о возникших проблемах).